name=llvm
from_source=llvm
revision=1
builddeps="base cmake python"
deps="core-libs ncurses zlib zstd"

build() {
    # XXX use Ninja instead of Make when we port it
    cmake \
        -G "Unix Makefiles" \
        -DCMAKE_INSTALL_PREFIX=${prefix} \
        -DCMAKE_BUILD_TYPE=Release \
        -DBUILD_SHARED_LIBS=ON \
        -DLLVM_ENABLE_EH=ON \
        -DLLVM_ENABLE_RTTI=ON \
        -DLLVM_BUILD_LLVM_DYLIB=ON \
        -Wno-dev \
        ${source_dir}/llvm

    make -j${parallelism}
}

package() {
    DESTDIR="${dest_dir}" make install

    post_package_strip
}
