name=fftw
from_source=fftw
revision=1
builddeps="base"
deps="core-libs"

_build_types="single float long-double"

build() {
    _build_dir=$(pwd -P)

    for x in ${_build_types}; do
        configure_flags="--enable-threads"
        case $x in
            single) configure_flags="$configure_flags --enable-sse --enable-avx --enable-single" ;;
            float) configure_flags="$configure_flags --enable-sse2 --enable-avx" ;;
            long-double) configure_flags="$configure_flags --enable-long-double" ;;
        esac

        mkdir -p "${_build_dir}/build-$x"
        cd "${_build_dir}/build-$x"
        autotools_configure_lib $configure_flags
        make -j${parallelism}
    done
}

package() {
    for x in ${_build_types}; do
        DESTDIR="${dest_dir}" make -C build-$x install
    done

    post_package_strip
}
