cross_compile=yes

name=glibc
from_source=glibc
revision=1
hostdeps="bootstrap-gcc"
deps="linux-headers"

build() {
    echo "slibdir=${prefix}/lib" >> configparms
    echo "rtlddir=${prefix}/lib" >> configparms
    echo "sbindir=${prefix}/bin" >> configparms
    echo "rootsbindir=${prefix}/bin" >> configparms

    autotools_configure_lib \
        --with-headers=${sysroot}${prefix}/include \
        --enable-bind-now \
        --enable-cet \
        --enable-fortify-source \
        --enable-kernel=4.4 \
        --enable-stack-protector=strong \
        --disable-nscd \
        --disable-profile \
        --disable-werror

    make -j${parallelism}
}

package() {
    DESTDIR=${dest_dir} make install

    # We use libiconv
    rm "${dest_dir}${prefix}"/bin/iconv* "${dest_dir}${prefix}"/include/iconv.h

    # We use libintl
    rm "${dest_dir}${prefix}"/include/libintl.h
    rm "${dest_dir}${prefix}"/share/locale/locale.alias
}
