name=icu
from_source=icu
revision=1
imagedeps="gcc"
hostdeps="gcc pkg-config"
deps="core-libs"

build() {
    mkdir cross-build
    cd cross-build
    ${source_dir}/source/configure \
        --prefix=/usr/local
    make -j${parallelism}
    cd ..

        configure_script_path=${source_dir}/source/configure \
    autotools_configure_lib \
        --with-cross-build=$(realpath cross-build)

    make -j${parallelism}
}

package() {
    DESTDIR="${dest_dir}" make install

    # figure out if we can call post_package_strip instead
    mv "${dest_dir}${prefix}"/bin/icu-config ./icu-config.bak
    ${OS_TRIPLET}-strip "${dest_dir}${prefix}"/bin/*
    mv ./icu-config.bak "${dest_dir}${prefix}"/bin/icu-config

    ${OS_TRIPLET}-strip "${dest_dir}${prefix}"/lib/*so.73.1
}
