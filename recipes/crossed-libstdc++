cross_compile=yes

name=crossed-libstdc++
from_source=gcc-host
revision=1
imagedeps="gcc"
hostdeps="gcc pkg-config"
deps="crossed-glibc crossed-libgcc"

build() {
    cd "${base_dir}"/host-builds/gcc/build

    make -j${parallelism} all-target-libstdc++-v3
}

package() {
    cd "${base_dir}"/host-builds/gcc/build

    rm -rf tmp_libstdc++_dir
    mkdir tmp_libstdc++_dir

    DESTDIR="$(realpath tmp_libstdc++_dir)" make install-strip-target-libstdc++-v3

    mkdir -p "${dest_dir}${prefix}"

    cp -r tmp_libstdc++_dir/usr/local/share "${dest_dir}${prefix}"/
    cp -r tmp_libstdc++_dir/usr/local/${CROSSED_TRIPLET}/* "${dest_dir}${prefix}"/
    # Remove static libraries
    rm -rf "${dest_dir}${prefix}"/lib/*.a

    # Copy libstdc++ and headers into GCC's tree else it will complain.
    mkdir -p "${base_dir}"/host-pkgs/gcc/usr/local/${CROSSED_TRIPLET}
    cp -r tmp_libstdc++_dir/usr/local/${CROSSED_TRIPLET}/* "${base_dir}"/host-pkgs/gcc/usr/local/${CROSSED_TRIPLET}/
}
